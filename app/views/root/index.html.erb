<% page_title t 'shared.common.name' %>
<% if @time_periods.present? && @countries.present? %>
  <% content_for :aside do %>
    <div class="time_periods">
      <%= t('.time_periods') %>
      <ul>
        <% @time_periods.each do |time_period| %>
          <li><%= link_to time_period.label, params.slice(:sort).merge(time_period: time_period) %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  <% @countries.each_with_index do |country, idx_country| %><div class="country">
      <div class="country-header">
        <h2><%= link_to country.name, country_path(country) %></h2>
        <div>
          <%= image_tag(country.flag_image.url(:thumb)) if country.flag_image.exists? %>
        </div>
      </div>
      <div class="country-story">
        <%
          story = @stories.select{|x| x.country_id == country.id}.first
          if story.present?
        %>
          <h3 class="country-story-title"><%= story.title %></h3>
          <div class="country-story-text">
            <%= simple_format story.content %>
          </div>
          <% if story.link.present? %>
            <%= link_to t('.view_story'), story.link, target: :blank, class: 'country-story-readmore' %>
          <% end %>
        <% else %>
          <p class="country-story-nostory">
            <%= t('.no_story') %>
          </p>
        <% end %>
      </div>
    </div><!--
--><% end %>
<% else %>
  <p class="alert alert-warning">
    <%= t('.no_data') %>
  </p>
<% end %>
